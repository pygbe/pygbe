
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pygbe.util.an_solution &#8212; PyGBe 0.2.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for pygbe.util.an_solution</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">It contains the functions to compute the cases that presents an analytical</span>
<span class="sd">solutions.</span>
<span class="sd">All functions output the analytical solution in kcal/mol</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">pi</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">special</span><span class="p">,</span> <span class="n">linalg</span>
<span class="kn">from</span> <span class="nn">scipy.misc</span> <span class="k">import</span> <span class="n">factorial</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">gamma</span>


<div class="viewcode-block" id="an_spherical"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.an_spherical">[docs]</a><span class="k">def</span> <span class="nf">an_spherical</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">xq</span><span class="p">,</span> <span class="n">E_1</span><span class="p">,</span> <span class="n">E_2</span><span class="p">,</span> <span class="n">E_0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the analytical solution of the potential of a sphere with</span>
<span class="sd">    Nq charges inside.</span>
<span class="sd">    Took from Kirkwood (1934).</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    q  : array, charges.</span>
<span class="sd">    xq : array, positions of the charges.</span>
<span class="sd">    E_1: float, dielectric constant inside the sphere.</span>
<span class="sd">    E_2: float, dielectric constant outside the sphere.</span>
<span class="sd">    E_0: float, dielectric constant of vacuum.</span>
<span class="sd">    R  : float, radius of the sphere.</span>
<span class="sd">    N  : int, number of terms desired in the spherical harmonic expansion.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    PHI: array, reaction potential.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">PHI</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)):</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xq</span><span class="p">[</span><span class="n">K</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">zenit</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">xq</span><span class="p">[</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">rho</span><span class="p">)</span>
        <span class="n">azim</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">xq</span><span class="p">[</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xq</span><span class="p">[</span><span class="n">K</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="mf">0.</span> <span class="o">+</span> <span class="mf">0.</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">sph1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">sph_harm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">zenit</span><span class="p">,</span> <span class="n">azim</span><span class="p">)</span>
                <span class="n">cons1</span> <span class="o">=</span> <span class="n">rho</span><span class="o">**</span><span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="n">E_1</span> <span class="o">*</span> <span class="n">E_0</span> <span class="o">*</span> <span class="n">R</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">E_1</span> <span class="o">-</span> <span class="n">E_2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">E_1</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">E_2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">cons2</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)):</span>
                    <span class="n">rho_k</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xq</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                    <span class="n">zenit_k</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">xq</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">rho_k</span><span class="p">)</span>
                    <span class="n">azim_k</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">xq</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xq</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="n">sph2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">special</span><span class="o">.</span><span class="n">sph_harm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">zenit_k</span><span class="p">,</span> <span class="n">azim_k</span><span class="p">))</span>
                    <span class="n">phi</span> <span class="o">+=</span> <span class="n">cons1</span> <span class="o">*</span> <span class="n">cons2</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">K</span><span class="p">]</span> <span class="o">*</span> <span class="n">rho_k</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">sph1</span> <span class="o">*</span> <span class="n">sph2</span>

        <span class="n">PHI</span><span class="p">[</span><span class="n">K</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span>
</div>
    <span class="k">return</span> <span class="n">PHI</span>


<div class="viewcode-block" id="get_K"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.get_K">[docs]</a><span class="k">def</span> <span class="nf">get_K</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the polinomials K needed for Kirkwood-1934 solutions.</span>
<span class="sd">    K_n(x) in Equation 4 in Kirkwood 1934.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    x: float, evaluation point of K.</span>
<span class="sd">    n: int, number of terms desired in the expansion.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    K: float, polinomials K.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">K</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">n_fact</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">n_fact2</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">K</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">**</span><span class="n">s</span> <span class="o">*</span> <span class="n">n_fact</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="n">n_fact2</span> <span class="o">*</span>
                                                     <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">s</span>
</div>
    <span class="k">return</span> <span class="n">K</span>


<div class="viewcode-block" id="an_P"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.an_P">[docs]</a><span class="k">def</span> <span class="nf">an_P</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">xq</span><span class="p">,</span> <span class="n">E_1</span><span class="p">,</span> <span class="n">E_2</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the solvation energy according to Kirkwood-1934.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    q    : array, charges.</span>
<span class="sd">    xq   : array, positions of the charges.</span>
<span class="sd">    E_1  : float, dielectric constant inside the sphere.</span>
<span class="sd">    E_2  : float, dielectric constant outside the sphere.</span>
<span class="sd">    R    : float, radius of the sphere.</span>
<span class="sd">    kappa: float, reciprocal of Debye length.</span>
<span class="sd">    a    : float, radius of the Stern Layer.</span>
<span class="sd">    N    : int, number of terms desired in the polinomial expansion.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    E_P  : float, solvation energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">qe</span> <span class="o">=</span> <span class="mf">1.60217646e-19</span>
    <span class="n">Na</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>
    <span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187818e-12</span>
    <span class="n">cal2J</span> <span class="o">=</span> <span class="mf">4.184</span>

    <span class="n">PHI</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)):</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xq</span><span class="p">[</span><span class="n">K</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">zenit</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">xq</span><span class="p">[</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">rho</span><span class="p">)</span>
        <span class="n">azim</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">xq</span><span class="p">[</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xq</span><span class="p">[</span><span class="n">K</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="mf">0.</span> <span class="o">+</span> <span class="mf">0.</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">P1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">lpmv</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">n</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">zenit</span><span class="p">))</span>

                <span class="n">Enm</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)):</span>
                    <span class="n">rho_k</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xq</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                    <span class="n">zenit_k</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">xq</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">rho_k</span><span class="p">)</span>
                    <span class="n">azim_k</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">xq</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xq</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="n">P2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">lpmv</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">n</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">zenit_k</span><span class="p">))</span>

                    <span class="n">Enm</span> <span class="o">+=</span> <span class="n">q</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">rho_k</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                        <span class="n">m</span><span class="p">))</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">m</span><span class="p">))</span> <span class="o">*</span> <span class="n">P2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                            <span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">azim_k</span><span class="p">)</span>

                <span class="n">C2</span> <span class="o">=</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">get_K</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">get_K</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">E_2</span> <span class="o">-</span> <span class="n">E_1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">E_2</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">E_1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span>
                    <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">get_K</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span>
                                                                <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
                <span class="n">C1</span> <span class="o">=</span> <span class="n">Enm</span> <span class="o">/</span> <span class="p">(</span><span class="n">E_2</span> <span class="o">*</span> <span class="n">E_0</span> <span class="o">*</span> <span class="n">a</span><span class="o">**</span>
                            <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">E_2</span> <span class="o">/</span> <span class="p">(</span>
                                <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">E_2</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">E_1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>

                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Bnm</span> <span class="o">=</span> <span class="n">Enm</span> <span class="o">/</span> <span class="p">(</span><span class="n">E_0</span> <span class="o">*</span> <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="mi">1</span> <span class="o">/</span> <span class="n">E_2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">E_1</span><span class="p">)</span> <span class="o">-</span> <span class="n">Enm</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span>
                            <span class="n">E_0</span> <span class="o">*</span> <span class="n">E_2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Bnm</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">E_1</span> <span class="o">*</span> <span class="n">E_0</span> <span class="o">*</span> <span class="n">R</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">E_1</span> <span class="o">-</span> <span class="n">E_2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">E_1</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">E_2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">Enm</span> <span class="o">-</span> <span class="n">C1</span> <span class="o">*</span> <span class="n">C2</span>

                <span class="n">phi</span> <span class="o">+=</span> <span class="n">Bnm</span> <span class="o">*</span> <span class="n">rho</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">P1</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">azim</span><span class="p">)</span>

        <span class="n">PHI</span><span class="p">[</span><span class="n">K</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span>

    <span class="n">C0</span> <span class="o">=</span> <span class="n">qe</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Na</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">/</span> <span class="p">(</span><span class="n">cal2J</span><span class="p">)</span>
    <span class="n">E_P</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">PHI</span><span class="p">)</span>
</div>
    <span class="k">return</span> <span class="n">E_P</span>



<div class="viewcode-block" id="two_sphere"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.two_sphere">[docs]</a><span class="k">def</span> <span class="nf">two_sphere</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">E_1</span><span class="p">,</span> <span class="n">E_2</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the analytical solution of a spherical surface and a spherical</span>
<span class="sd">    molecule with a center charge, both of radius R.</span>
<span class="sd">    Follows Cooper&amp;Barba 2016</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    a    : float, center to center distance.</span>
<span class="sd">    R    : float, radius of surface and molecule.</span>
<span class="sd">    kappa: float, reciprocal of Debye length.</span>
<span class="sd">    E_1  : float, dielectric constant inside the sphere.</span>
<span class="sd">    E_2  : float, dielectric constant outside the sphere.</span>
<span class="sd">    q    : float, number of qe to be asigned to the charge.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    Einter  : float, interaction energy.</span>
<span class="sd">    E1sphere: float, solvation energy of one sphere.</span>
<span class="sd">    E2sphere: float, solvation energy of two spheres together.</span>

<span class="sd">    Note:</span>
<span class="sd">    Einter should match (E2sphere - 2xE1sphere)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of terms in expansion.</span>

    <span class="n">qe</span> <span class="o">=</span> <span class="mf">1.60217646e-19</span>
    <span class="n">Na</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>
    <span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187818e-12</span>
    <span class="n">cal2J</span> <span class="o">=</span> <span class="mf">4.184</span>

    <span class="n">index2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">K1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">K1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">K1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">k1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">))</span>
    <span class="n">k1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">))</span> <span class="o">*</span> <span class="n">K1p</span>

    <span class="n">I1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">I1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">I1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">))</span>
    <span class="n">i1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">))</span> <span class="o">*</span> <span class="n">I1p</span>

    <span class="n">B</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">nu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">nu</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="n">nu</span><span class="p">:</span>
                    <span class="n">g1</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g2</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g3</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g4</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">1.5</span><span class="p">)</span>
                    <span class="n">f1</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f2</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f3</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f4</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
                    <span class="n">Anm</span> <span class="o">=</span> <span class="n">g1</span> <span class="o">*</span> <span class="n">g2</span> <span class="o">*</span> <span class="n">g3</span> <span class="o">*</span> <span class="n">f1</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="n">pi</span> <span class="o">*</span> <span class="n">g4</span> <span class="o">*</span> <span class="n">f2</span> <span class="o">*</span> <span class="n">f3</span> <span class="o">*</span> <span class="n">f4</span><span class="p">)</span>
                    <span class="n">kB</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span>
                                    <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">R</span><span class="p">))</span>
                    <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Anm</span> <span class="o">*</span> <span class="n">kB</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">E_hat</span> <span class="o">=</span> <span class="n">E_1</span> <span class="o">/</span> <span class="n">E_2</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">kappa</span> <span class="o">*</span> <span class="n">i1p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">E_hat</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">E_hat</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span>

    <span class="n">RHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">RHS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">E_hat</span> <span class="o">*</span> <span class="n">q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">E_1</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">a_coeff</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">RHS</span><span class="p">)</span>

    <span class="n">a0</span> <span class="o">=</span> <span class="n">a_coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a0_inf</span> <span class="o">=</span> <span class="o">-</span><span class="n">E_hat</span> <span class="o">*</span> <span class="n">q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">E_1</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">phi_2</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a_coeff</span> <span class="o">*</span> <span class="n">B</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span>
                                                                     <span class="n">E_1</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">phi_1</span> <span class="o">=</span> <span class="n">a0_inf</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">E_1</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">phi_inter</span> <span class="o">=</span> <span class="n">phi_2</span> <span class="o">-</span> <span class="n">phi_1</span>

    <span class="n">CC0</span> <span class="o">=</span> <span class="n">qe</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Na</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">/</span> <span class="p">(</span><span class="n">cal2J</span> <span class="o">*</span> <span class="n">E_0</span><span class="p">)</span>

    <span class="n">Einter</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">CC0</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">phi_inter</span>
    <span class="n">E1sphere</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">CC0</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">phi_1</span>
    <span class="n">E2sphere</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">CC0</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">phi_2</span>
</div>
    <span class="k">return</span> <span class="n">Einter</span><span class="p">,</span> <span class="n">E1sphere</span><span class="p">,</span> <span class="n">E2sphere</span>


<div class="viewcode-block" id="constant_potential_single_point"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.constant_potential_single_point">[docs]</a><span class="k">def</span> <span class="nf">constant_potential_single_point</span><span class="p">(</span><span class="n">phi0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the potential in a point &#39;r&#39; due to a spherical surface</span>
<span class="sd">    with constant potential phi0, immersed in water. Solution to the</span>
<span class="sd">    Poisson-Boltzmann problem.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    phi0 : float, constant potential on the surface of the sphere.</span>
<span class="sd">    a    : float, radius of the sphere.</span>
<span class="sd">    r    : float, distance from the center of the sphere to the evaluation</span>
<span class="sd">                  point.</span>
<span class="sd">    kappa: float, reciprocal of Debye length.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    phi  : float, potential.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">r</span> <span class="o">*</span> <span class="n">phi0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">r</span><span class="p">))</span>
</div>
    <span class="k">return</span> <span class="n">phi</span>


<div class="viewcode-block" id="constant_charge_single_point"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.constant_charge_single_point">[docs]</a><span class="k">def</span> <span class="nf">constant_charge_single_point</span><span class="p">(</span><span class="n">sigma0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the potential in a point &#39;r&#39; due to a spherical surface</span>
<span class="sd">    with constant charge sigma0 immersed in water. Solution to the</span>
<span class="sd">    Poisson-Boltzmann problem. .</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    sigma0 : float, constant charge on the surface of the sphere.</span>
<span class="sd">    a      : float, radius of the sphere.</span>
<span class="sd">    r      : float, distance from the center of the sphere to the evaluation</span>
<span class="sd">                    point.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    epsilon: float, water dielectric constant.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    phi  : float, potential.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dphi0</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma0</span> <span class="o">/</span> <span class="n">epsilon</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="o">-</span><span class="n">dphi0</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">r</span><span class="p">))</span> <span class="o">/</span> <span class="n">r</span>
</div>
    <span class="k">return</span> <span class="n">phi</span>


<div class="viewcode-block" id="constant_potential_single_charge"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.constant_potential_single_charge">[docs]</a><span class="k">def</span> <span class="nf">constant_potential_single_charge</span><span class="p">(</span><span class="n">phi0</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the surface charge of a sphere at constant potential, immersed</span>
<span class="sd">    in water.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    phi0   : float, constant potential on the surface of the sphere.</span>
<span class="sd">    radius : float, radius of the sphere.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    epsilon: float, water dielectric constant .</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    sigma  : float, surface charge.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dphi</span> <span class="o">=</span> <span class="o">-</span><span class="n">phi0</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span> <span class="o">/</span> <span class="n">radius</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="o">-</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">dphi</span>  <span class="c1"># Surface charge</span>
</div>
    <span class="k">return</span> <span class="n">sigma</span>


<div class="viewcode-block" id="constant_charge_single_potential"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.constant_charge_single_potential">[docs]</a><span class="k">def</span> <span class="nf">constant_charge_single_potential</span><span class="p">(</span><span class="n">sigma0</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the surface potential on a sphere at constant charged, immersed</span>
<span class="sd">    in water.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    sigma0 : float, constant charge on the surface of the sphere.</span>
<span class="sd">    radius : float, radius of the sphere.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    epsilon: float, water dielectric constant.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    phi  : float, potential.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dphi</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma0</span> <span class="o">/</span> <span class="n">epsilon</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="o">-</span><span class="n">dphi</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>  <span class="c1"># Surface potential</span>
</div>
    <span class="k">return</span> <span class="n">phi</span>



<div class="viewcode-block" id="constant_potential_twosphere"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.constant_potential_twosphere">[docs]</a><span class="k">def</span> <span class="nf">constant_potential_twosphere</span><span class="p">(</span><span class="n">phi01</span><span class="p">,</span> <span class="n">phi02</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the solvation energy of two spheres at constant potential,</span>
<span class="sd">    immersed in water.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    phi01  : float, constant potential on the surface of the sphere 1.</span>
<span class="sd">    phi02  : float, constant potential on the surface of the sphere 2.</span>
<span class="sd">    r1     : float, radius of sphere 1.</span>
<span class="sd">    r2     : float, radius of sphere 2.</span>
<span class="sd">    R      : float, distance center to center.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    epsilon: float, water dielectric constant.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    E_solv  : float, solvation energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">kT</span> <span class="o">=</span> <span class="mf">4.1419464e-21</span>  <span class="c1"># at 300K</span>
    <span class="n">qe</span> <span class="o">=</span> <span class="mf">1.60217646e-19</span>
    <span class="n">Na</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>
    <span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187818e-12</span>
    <span class="n">cal2J</span> <span class="o">=</span> <span class="mf">4.184</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="n">kT</span> <span class="o">/</span> <span class="n">qe</span>

    <span class="n">phi01</span> <span class="o">/=</span> <span class="n">C0</span>
    <span class="n">phi02</span> <span class="o">/=</span> <span class="n">C0</span>

    <span class="n">k1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span>
    <span class="n">B00</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">R</span><span class="p">))</span>
    <span class="c1">#    k1 = special.kv(0.5,kappa*r1)*numpy.sqrt(2/(pi*kappa*r1))</span>
    <span class="c1">#    k2 = special.kv(0.5,kappa*r2)*numpy.sqrt(2/(pi*kappa*r2))</span>
    <span class="c1">#    B00 = special.kv(0.5,kappa*R)*numpy.sqrt(2/(pi*kappa*R))</span>

    <span class="n">i1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span>

    <span class="n">a0</span> <span class="o">=</span> <span class="p">(</span><span class="n">phi02</span> <span class="o">*</span> <span class="n">B00</span> <span class="o">*</span> <span class="n">i1</span> <span class="o">-</span> <span class="n">phi01</span> <span class="o">*</span> <span class="n">k2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">B00</span> <span class="o">*</span> <span class="n">B00</span> <span class="o">*</span> <span class="n">i2</span> <span class="o">*</span> <span class="n">i1</span> <span class="o">-</span> <span class="n">k1</span> <span class="o">*</span> <span class="n">k2</span><span class="p">)</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="p">(</span><span class="n">phi02</span> <span class="o">*</span> <span class="n">k1</span> <span class="o">-</span> <span class="n">phi01</span> <span class="o">*</span> <span class="n">B00</span> <span class="o">*</span> <span class="n">i2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">k2</span> <span class="o">*</span> <span class="n">k1</span> <span class="o">-</span> <span class="n">B00</span> <span class="o">*</span> <span class="n">B00</span> <span class="o">*</span> <span class="n">i1</span> <span class="o">*</span> <span class="n">i2</span><span class="p">)</span>

    <span class="n">U1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">phi01</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi01</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span>
                           <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">-</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">a0</span> <span class="o">/</span>
                           <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i1</span><span class="p">))</span>
    <span class="n">U2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">phi02</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi02</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span>
                           <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">-</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">b0</span> <span class="o">/</span>
                           <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i2</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;U1: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;U2: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U1</span> <span class="o">+</span> <span class="n">U2</span><span class="p">))</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">epsilon</span> <span class="o">/</span> <span class="n">kappa</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">U1</span> <span class="o">*</span> <span class="n">C1</span>
    <span class="n">u2</span> <span class="o">=</span> <span class="n">U2</span> <span class="o">*</span> <span class="n">C1</span>

    <span class="n">CC0</span> <span class="o">=</span> <span class="n">qe</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Na</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">/</span> <span class="p">(</span><span class="n">cal2J</span> <span class="o">*</span> <span class="n">E_0</span><span class="p">)</span>

    <span class="n">E_solv</span> <span class="o">=</span> <span class="n">CC0</span> <span class="o">*</span> <span class="p">(</span><span class="n">u1</span> <span class="o">+</span> <span class="n">u2</span><span class="p">)</span>
</div>
    <span class="k">return</span> <span class="n">E_solv</span>


<div class="viewcode-block" id="constant_potential_twosphere_2"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.constant_potential_twosphere_2">[docs]</a><span class="k">def</span> <span class="nf">constant_potential_twosphere_2</span><span class="p">(</span><span class="n">phi01</span><span class="p">,</span> <span class="n">phi02</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the solvation energy of two spheres at constant potential,</span>
<span class="sd">    immersed in water.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    phi01  : float, constant potential on the surface of the sphere 1.</span>
<span class="sd">    phi02  : float, constant potential on the surface of the sphere 2.</span>
<span class="sd">    r1     : float, radius of sphere 1.</span>
<span class="sd">    r2     : float, radius of sphere 2.</span>
<span class="sd">    R      : float, distance center to center.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    epsilon: float, water dielectric constant.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    E_solv  : float, solvation energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">kT</span> <span class="o">=</span> <span class="mf">4.1419464e-21</span>  <span class="c1"># at 300K</span>
    <span class="n">qe</span> <span class="o">=</span> <span class="mf">1.60217646e-19</span>
    <span class="n">Na</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>
    <span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187818e-12</span>
    <span class="n">cal2J</span> <span class="o">=</span> <span class="mf">4.184</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">R</span> <span class="o">-</span> <span class="n">r1</span> <span class="o">-</span> <span class="n">r2</span>
    <span class="c1">#    E_inter = r1*r2*epsilon/(4*R) * ( (phi01+phi02)**2 * log(1+numpy.exp(-kappa*h)) + (phi01-phi02)**2*log(1-numpy.exp(-kappa*h)) )</span>
    <span class="c1">#    E_inter = epsilon*r1*phi01**2/2 * log(1+numpy.exp(-kappa*h))</span>
    <span class="n">E_solv</span> <span class="o">=</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi01</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">phi02</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">r1</span> <span class="o">+</span> <span class="n">r2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span>
        <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">phi01</span> <span class="o">*</span> <span class="n">phi02</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">phi01</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">phi02</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">h</span><span class="p">))</span> <span class="o">/</span>
            <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">h</span><span class="p">)))</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">h</span><span class="p">)))</span>

    <span class="n">CC0</span> <span class="o">=</span> <span class="n">qe</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Na</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">/</span> <span class="p">(</span><span class="n">cal2J</span> <span class="o">*</span> <span class="n">E_0</span><span class="p">)</span>
    <span class="n">E_solv</span> <span class="o">*=</span> <span class="n">CC0</span></div>
    <span class="k">return</span> <span class="n">E_solv</span>


<div class="viewcode-block" id="constant_potential_single_energy"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.constant_potential_single_energy">[docs]</a><span class="k">def</span> <span class="nf">constant_potential_single_energy</span><span class="p">(</span><span class="n">phi0</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the total energy of a single sphere at constant potential,</span>
<span class="sd">    inmmersed in water.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    phi0   : float, constant potential on the surface of the sphere.</span>
<span class="sd">    r1     : float, radius of sphere.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    epsilon: float, water dielectric constant.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    E      : float, total energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Number of terms in expansion</span>

    <span class="n">qe</span> <span class="o">=</span> <span class="mf">1.60217646e-19</span>
    <span class="n">Na</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>
    <span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187818e-12</span>
    <span class="n">cal2J</span> <span class="o">=</span> <span class="mf">4.184</span>

    <span class="n">index2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">K1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">K1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">K1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">k1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span> <span class="o">*</span> <span class="n">K1p</span>

    <span class="n">a0_inf</span> <span class="o">=</span> <span class="n">phi0</span> <span class="o">/</span> <span class="n">k1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">U1_inf</span> <span class="o">=</span> <span class="n">a0_inf</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">C1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">phi0</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">epsilon</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="n">qe</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Na</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">/</span> <span class="p">(</span><span class="n">cal2J</span> <span class="o">*</span> <span class="n">E_0</span><span class="p">)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">C1</span> <span class="o">*</span> <span class="n">U1_inf</span>
</div>
    <span class="k">return</span> <span class="n">E</span>


<div class="viewcode-block" id="constant_charge_single_energy"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.constant_charge_single_energy">[docs]</a><span class="k">def</span> <span class="nf">constant_charge_single_energy</span><span class="p">(</span><span class="n">sigma0</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the total energy of a single sphere at constant charge,</span>
<span class="sd">    inmmersed in water.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    sigma0 : float, constant charge on the surface of the sphere.</span>
<span class="sd">    r1     : float, radius of sphere.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    epsilon: float, water dielectric constant.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    E      : float, total energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of terms in expansion</span>

    <span class="n">qe</span> <span class="o">=</span> <span class="mf">1.60217646e-19</span>
    <span class="n">Na</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>
    <span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187818e-12</span>
    <span class="n">cal2J</span> <span class="o">=</span> <span class="mf">4.184</span>

    <span class="n">index2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">K1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">K1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">K1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">k1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span> <span class="o">*</span> <span class="n">K1p</span>

    <span class="n">a0_inf</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma0</span> <span class="o">/</span> <span class="p">(</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">U1_inf</span> <span class="o">=</span> <span class="n">a0_inf</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">C1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">sigma0</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r1</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="n">qe</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Na</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">/</span> <span class="p">(</span><span class="n">cal2J</span> <span class="o">*</span> <span class="n">E_0</span><span class="p">)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">C1</span> <span class="o">*</span> <span class="n">U1_inf</span>
</div>
    <span class="k">return</span> <span class="n">E</span>


<div class="viewcode-block" id="constant_potential_twosphere_dissimilar"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.constant_potential_twosphere_dissimilar">[docs]</a><span class="k">def</span> <span class="nf">constant_potential_twosphere_dissimilar</span><span class="p">(</span><span class="n">phi01</span><span class="p">,</span> <span class="n">phi02</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span>
                                            <span class="n">epsilon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the interaction energy for dissimilar spheres at constant</span>
<span class="sd">    potential, immersed in water.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    phi01  : float, constant potential on the surface of the sphere 1.</span>
<span class="sd">    phi02  : float, constant potential on the surface of the sphere 2.</span>
<span class="sd">    r1     : float, radius of sphere 1.</span>
<span class="sd">    r2     : float, radius of sphere 2.</span>
<span class="sd">    R      : float, distance center to center.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    epsilon: float, water dielectric constant.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    E_inter: float, interaction energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of terms in expansion</span>

    <span class="n">qe</span> <span class="o">=</span> <span class="mf">1.60217646e-19</span>
    <span class="n">Na</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>
    <span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187818e-12</span>
    <span class="n">cal2J</span> <span class="o">=</span> <span class="mf">4.184</span>

    <span class="n">index2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">K1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">K1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">K1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">k1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span> <span class="o">*</span> <span class="n">K1p</span>

    <span class="n">K2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">K2p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">K2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span>
    <span class="n">k2p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span> <span class="o">*</span> <span class="n">K2p</span>

    <span class="n">I1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">I1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">I1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">i1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span> <span class="o">*</span> <span class="n">I1p</span>

    <span class="n">I2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">I2p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">I2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span>
    <span class="n">i2p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span> <span class="o">*</span> <span class="n">I2p</span>

    <span class="n">B</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">nu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">nu</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="n">nu</span><span class="p">:</span>
                    <span class="n">g1</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g2</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g3</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g4</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">1.5</span><span class="p">)</span>
                    <span class="n">f1</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f2</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f3</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f4</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
                    <span class="n">Anm</span> <span class="o">=</span> <span class="n">g1</span> <span class="o">*</span> <span class="n">g2</span> <span class="o">*</span> <span class="n">g3</span> <span class="o">*</span> <span class="n">f1</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="n">pi</span> <span class="o">*</span> <span class="n">g4</span> <span class="o">*</span> <span class="n">f2</span> <span class="o">*</span> <span class="n">f3</span> <span class="o">*</span> <span class="n">f4</span><span class="p">)</span>
                    <span class="n">kB</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span>
                                    <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">R</span><span class="p">))</span>
                    <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Anm</span> <span class="o">*</span> <span class="n">kB</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">i1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">k2</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">M</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">i2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">k1</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">M</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">N</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">RHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">RHS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi01</span>
    <span class="n">RHS</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi02</span>

    <span class="n">coeff</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">RHS</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">]</span> <span class="o">/</span> <span class="n">k1</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">N</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">]</span> <span class="o">/</span> <span class="n">k2</span>

    <span class="n">a0</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a0_inf</span> <span class="o">=</span> <span class="n">phi01</span> <span class="o">/</span> <span class="n">k1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b0_inf</span> <span class="o">=</span> <span class="n">phi02</span> <span class="o">/</span> <span class="n">k2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">U1_inf</span> <span class="o">=</span> <span class="n">a0_inf</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">U1_h</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i1p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">B</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="n">U2_inf</span> <span class="o">=</span> <span class="n">b0_inf</span> <span class="o">*</span> <span class="n">k2p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">U2_h</span> <span class="o">=</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">k2p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i2p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">B</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="n">C1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">phi01</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">epsilon</span>
    <span class="n">C2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">phi02</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">epsilon</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="n">qe</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Na</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">/</span> <span class="p">(</span><span class="n">cal2J</span> <span class="o">*</span> <span class="n">E_0</span><span class="p">)</span>
    <span class="n">E_inter</span> <span class="o">=</span> <span class="n">C0</span> <span class="o">*</span> <span class="p">(</span><span class="n">C1</span> <span class="o">*</span> <span class="p">(</span><span class="n">U1_h</span> <span class="o">-</span> <span class="n">U1_inf</span><span class="p">)</span> <span class="o">+</span> <span class="n">C2</span> <span class="o">*</span> <span class="p">(</span><span class="n">U2_h</span> <span class="o">-</span> <span class="n">U2_inf</span><span class="p">))</span>
</div>
    <span class="k">return</span> <span class="n">E_inter</span>


<div class="viewcode-block" id="constant_charge_twosphere_dissimilar"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.constant_charge_twosphere_dissimilar">[docs]</a><span class="k">def</span> <span class="nf">constant_charge_twosphere_dissimilar</span><span class="p">(</span><span class="n">sigma01</span><span class="p">,</span> <span class="n">sigma02</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span>
                                         <span class="n">epsilon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the interaction energy between two dissimilar spheres at</span>
<span class="sd">    constant charge, immersed in water.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    sigma01: float, constant charge on the surface of the sphere 1.</span>
<span class="sd">    sigma02: float, constant charge on the surface of the sphere 2.</span>
<span class="sd">    r1     : float, radius of sphere 1.</span>
<span class="sd">    r2     : float, radius of sphere 2.</span>
<span class="sd">    R      : float, distance center to center.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    epsilon: float, water dielectric constant.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    E_inter: float, interaction energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of terms in expansion</span>

    <span class="n">qe</span> <span class="o">=</span> <span class="mf">1.60217646e-19</span>
    <span class="n">Na</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>
    <span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187818e-12</span>
    <span class="n">cal2J</span> <span class="o">=</span> <span class="mf">4.184</span>

    <span class="n">index2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">K1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">K1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">K1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">k1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span> <span class="o">*</span> <span class="n">K1p</span>

    <span class="n">K2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">K2p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">K2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span>
    <span class="n">k2p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span> <span class="o">*</span> <span class="n">K2p</span>

    <span class="n">I1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">I1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">I1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">i1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span> <span class="o">*</span> <span class="n">I1p</span>

    <span class="n">I2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">I2p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">I2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span>
    <span class="n">i2p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span> <span class="o">*</span> <span class="n">I2p</span>

    <span class="n">B</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">nu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">nu</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="n">nu</span><span class="p">:</span>
                    <span class="n">g1</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g2</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g3</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g4</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">1.5</span><span class="p">)</span>
                    <span class="n">f1</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f2</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f3</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f4</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
                    <span class="n">Anm</span> <span class="o">=</span> <span class="n">g1</span> <span class="o">*</span> <span class="n">g2</span> <span class="o">*</span> <span class="n">g3</span> <span class="o">*</span> <span class="n">f1</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="n">pi</span> <span class="o">*</span> <span class="n">g4</span> <span class="o">*</span> <span class="n">f2</span> <span class="o">*</span> <span class="n">f3</span> <span class="o">*</span> <span class="n">f4</span><span class="p">)</span>
                    <span class="n">kB</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span>
                                    <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">R</span><span class="p">))</span>
                    <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Anm</span> <span class="o">*</span> <span class="n">kB</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">i1p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="n">k2p</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
            <span class="n">M</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">i2p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">r1</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">M</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">N</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">RHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">RHS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma01</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">/</span> <span class="n">epsilon</span>
    <span class="n">RHS</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma02</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">/</span> <span class="n">epsilon</span>

    <span class="n">coeff</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">RHS</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="n">r1</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">N</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="n">r2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">k2p</span><span class="p">)</span>

    <span class="n">a0</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a0_inf</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma01</span> <span class="o">/</span> <span class="p">(</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b0_inf</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma02</span> <span class="o">/</span> <span class="p">(</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">k2p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">U1_inf</span> <span class="o">=</span> <span class="n">a0_inf</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">U1_h</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">B</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="n">U2_inf</span> <span class="o">=</span> <span class="n">b0_inf</span> <span class="o">*</span> <span class="n">k2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">U2_h</span> <span class="o">=</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">k2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">B</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="n">C1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">sigma01</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r1</span>
    <span class="n">C2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">sigma02</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">r2</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="n">qe</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Na</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">/</span> <span class="p">(</span><span class="n">cal2J</span> <span class="o">*</span> <span class="n">E_0</span><span class="p">)</span>
    <span class="n">E_inter</span> <span class="o">=</span> <span class="n">C0</span> <span class="o">*</span> <span class="p">(</span><span class="n">C1</span> <span class="o">*</span> <span class="p">(</span><span class="n">U1_h</span> <span class="o">-</span> <span class="n">U1_inf</span><span class="p">)</span> <span class="o">+</span> <span class="n">C2</span> <span class="o">*</span> <span class="p">(</span><span class="n">U2_h</span> <span class="o">-</span> <span class="n">U2_inf</span><span class="p">))</span>
</div>
    <span class="k">return</span> <span class="n">E_inter</span>


<div class="viewcode-block" id="molecule_constant_potential"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.molecule_constant_potential">[docs]</a><span class="k">def</span> <span class="nf">molecule_constant_potential</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">phi02</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">E_1</span><span class="p">,</span> <span class="n">E_2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the interaction energy between a molecule (sphere with</span>
<span class="sd">    point-charge in the center) and a sphere at constant potential, immersed</span>
<span class="sd">    in water.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    q      : float, number of qe to be asigned to the charge.</span>
<span class="sd">    phi02  : float, constant potential on the surface of the sphere 2.</span>
<span class="sd">    r1     : float, radius of sphere 1, i.e the molecule.</span>
<span class="sd">    r2     : float, radius of sphere 2.</span>
<span class="sd">    R      : float, distance center to center.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    E_1    : float, dielectric constant inside the sphere/molecule.</span>
<span class="sd">    E_2    : float, dielectric constant outside the sphere/molecule.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    E_inter: float, interaction energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of terms in expansion</span>

    <span class="n">qe</span> <span class="o">=</span> <span class="mf">1.60217646e-19</span>
    <span class="n">Na</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>
    <span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187818e-12</span>
    <span class="n">cal2J</span> <span class="o">=</span> <span class="mf">4.184</span>

    <span class="n">index2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">K1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">K1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">K1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">k1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span> <span class="o">*</span> <span class="n">K1p</span>

    <span class="n">K2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">K2p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">K2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span>
    <span class="n">k2p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span> <span class="o">*</span> <span class="n">K2p</span>

    <span class="n">I1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">I1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">I1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">i1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span> <span class="o">*</span> <span class="n">I1p</span>

    <span class="n">I2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">I2p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">I2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span>
    <span class="n">i2p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span> <span class="o">*</span> <span class="n">I2p</span>

    <span class="n">B</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">nu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">nu</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="n">nu</span><span class="p">:</span>
                    <span class="n">g1</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g2</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g3</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g4</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">1.5</span><span class="p">)</span>
                    <span class="n">f1</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f2</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f3</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f4</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
                    <span class="n">Anm</span> <span class="o">=</span> <span class="n">g1</span> <span class="o">*</span> <span class="n">g2</span> <span class="o">*</span> <span class="n">g3</span> <span class="o">*</span> <span class="n">f1</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="n">pi</span> <span class="o">*</span> <span class="n">g4</span> <span class="o">*</span> <span class="n">f2</span> <span class="o">*</span> <span class="n">f3</span> <span class="o">*</span> <span class="n">f4</span><span class="p">)</span>
                    <span class="n">kB</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span>
                                    <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">R</span><span class="p">))</span>
                    <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Anm</span> <span class="o">*</span> <span class="n">kB</span>

    <span class="n">E_hat</span> <span class="o">=</span> <span class="n">E_1</span> <span class="o">/</span> <span class="n">E_2</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">kappa</span> <span class="o">*</span> <span class="n">i1p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">k2</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">E_hat</span> <span class="o">*</span> <span class="n">j</span> <span class="o">/</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">i1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">k2</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
            <span class="n">M</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">i2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">kappa</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">E_hat</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">M</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">N</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">RHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">RHS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">E_hat</span> <span class="o">*</span> <span class="n">q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">E_1</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">RHS</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi02</span>

    <span class="n">coeff</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">RHS</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">k1p</span> <span class="o">-</span> <span class="n">E_hat</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">/</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">k1</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">N</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">]</span> <span class="o">/</span> <span class="n">k2</span>

    <span class="n">a0</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a0_inf</span> <span class="o">=</span> <span class="o">-</span><span class="n">E_hat</span> <span class="o">*</span> <span class="n">q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">E_1</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b0_inf</span> <span class="o">=</span> <span class="n">phi02</span> <span class="o">/</span> <span class="n">k2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">phi_inf</span> <span class="o">=</span> <span class="n">a0_inf</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">E_1</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">phi_h</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">B</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">E_1</span> <span class="o">*</span>
                                                               <span class="n">r1</span><span class="p">)</span>
    <span class="n">phi_inter</span> <span class="o">=</span> <span class="n">phi_h</span> <span class="o">-</span> <span class="n">phi_inf</span>

    <span class="n">U_inf</span> <span class="o">=</span> <span class="n">b0_inf</span> <span class="o">*</span> <span class="n">k2p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">U_h</span> <span class="o">=</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">k2p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i2p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">B</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">U_inter</span> <span class="o">=</span> <span class="n">U_h</span> <span class="o">-</span> <span class="n">U_inf</span>

    <span class="n">C0</span> <span class="o">=</span> <span class="n">qe</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Na</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">/</span> <span class="p">(</span><span class="n">cal2J</span> <span class="o">*</span> <span class="n">E_0</span><span class="p">)</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="mf">0.5</span>
    <span class="n">C2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">phi02</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">E_2</span>
    <span class="n">E_inter</span> <span class="o">=</span> <span class="n">C0</span> <span class="o">*</span> <span class="p">(</span><span class="n">C1</span> <span class="o">*</span> <span class="n">phi_inter</span> <span class="o">+</span> <span class="n">C2</span> <span class="o">*</span> <span class="n">U_inter</span><span class="p">)</span>
</div>
    <span class="k">return</span> <span class="n">E_inter</span>


<div class="viewcode-block" id="molecule_constant_charge"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.molecule_constant_charge">[docs]</a><span class="k">def</span> <span class="nf">molecule_constant_charge</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">sigma02</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">E_1</span><span class="p">,</span> <span class="n">E_2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the interaction energy between a molecule (sphere with</span>
<span class="sd">    point-charge in the center) and a sphere at constant charge, immersed</span>
<span class="sd">    in water.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    q      : float, number of qe to be asigned to the charge.</span>
<span class="sd">    sigma02: float, constant charge on the surface of the sphere 2.</span>
<span class="sd">    r1     : float, radius of sphere 1, i.e the molecule.</span>
<span class="sd">    r2     : float, radius of sphere 2.</span>
<span class="sd">    R      : float, distance center to center.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    E_1    : float, dielectric constant inside the sphere/molecule.</span>
<span class="sd">    E_2    : float, dielectric constant outside the sphere/molecule.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    E_inter: float, interaction energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of terms in expansion</span>

    <span class="n">qe</span> <span class="o">=</span> <span class="mf">1.60217646e-19</span>
    <span class="n">Na</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>
    <span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187818e-12</span>
    <span class="n">cal2J</span> <span class="o">=</span> <span class="mf">4.184</span>

    <span class="n">index2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">K1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">K1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">K1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">k1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span> <span class="o">*</span> <span class="n">K1p</span>

    <span class="n">K2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">K2p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">K2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span>
    <span class="n">k2p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span> <span class="o">*</span> <span class="n">K2p</span>

    <span class="n">I1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">I1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">I1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">i1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span> <span class="o">*</span> <span class="n">I1p</span>

    <span class="n">I2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">I2p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">I2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span>
    <span class="n">i2p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span> <span class="o">*</span> <span class="n">I2p</span>

    <span class="n">B</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">nu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">nu</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="n">nu</span><span class="p">:</span>
                    <span class="n">g1</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g2</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g3</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g4</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">1.5</span><span class="p">)</span>
                    <span class="n">f1</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f2</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f3</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f4</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
                    <span class="n">Anm</span> <span class="o">=</span> <span class="n">g1</span> <span class="o">*</span> <span class="n">g2</span> <span class="o">*</span> <span class="n">g3</span> <span class="o">*</span> <span class="n">f1</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="n">pi</span> <span class="o">*</span> <span class="n">g4</span> <span class="o">*</span> <span class="n">f2</span> <span class="o">*</span> <span class="n">f3</span> <span class="o">*</span> <span class="n">f4</span><span class="p">)</span>
                    <span class="n">kB</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span>
                                    <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">R</span><span class="p">))</span>
                    <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Anm</span> <span class="o">*</span> <span class="n">kB</span>

    <span class="n">E_hat</span> <span class="o">=</span> <span class="n">E_1</span> <span class="o">/</span> <span class="n">E_2</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">i1p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">k2p</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">E_hat</span> <span class="o">*</span> <span class="n">j</span> <span class="o">/</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">i1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">k2p</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
            <span class="n">M</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">i2p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">kappa</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">E_hat</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">M</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">N</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">RHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">RHS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">E_hat</span> <span class="o">*</span> <span class="n">q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">E_1</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">RHS</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma02</span> <span class="o">/</span> <span class="n">E_2</span>

    <span class="n">coeff</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">RHS</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">k1p</span> <span class="o">-</span> <span class="n">E_hat</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">/</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">k1</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="n">N</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">k2p</span><span class="p">)</span>

    <span class="n">a0</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a0_inf</span> <span class="o">=</span> <span class="o">-</span><span class="n">E_hat</span> <span class="o">*</span> <span class="n">q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">E_1</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b0_inf</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma02</span> <span class="o">/</span> <span class="p">(</span><span class="n">E_2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">k2p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">phi_inf</span> <span class="o">=</span> <span class="n">a0_inf</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">E_1</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">phi_h</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">B</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">E_1</span> <span class="o">*</span>
                                                               <span class="n">r1</span><span class="p">)</span>
    <span class="n">phi_inter</span> <span class="o">=</span> <span class="n">phi_h</span> <span class="o">-</span> <span class="n">phi_inf</span>

    <span class="n">U_inf</span> <span class="o">=</span> <span class="n">b0_inf</span> <span class="o">*</span> <span class="n">k2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">U_h</span> <span class="o">=</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">k2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">B</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">U_inter</span> <span class="o">=</span> <span class="n">U_h</span> <span class="o">-</span> <span class="n">U_inf</span>

    <span class="n">C0</span> <span class="o">=</span> <span class="n">qe</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Na</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">/</span> <span class="p">(</span><span class="n">cal2J</span> <span class="o">*</span> <span class="n">E_0</span><span class="p">)</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="mf">0.5</span>
    <span class="n">C2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">sigma02</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">r2</span>
    <span class="n">E_inter</span> <span class="o">=</span> <span class="n">C0</span> <span class="o">*</span> <span class="p">(</span><span class="n">C1</span> <span class="o">*</span> <span class="n">phi_inter</span> <span class="o">+</span> <span class="n">C2</span> <span class="o">*</span> <span class="n">U_inter</span><span class="p">)</span>
</div>
    <span class="k">return</span> <span class="n">E_inter</span>


<div class="viewcode-block" id="constant_potential_twosphere_identical"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.constant_potential_twosphere_identical">[docs]</a><span class="k">def</span> <span class="nf">constant_potential_twosphere_identical</span><span class="p">(</span><span class="n">phi01</span><span class="p">,</span> <span class="n">phi02</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span>
                                           <span class="n">epsilon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the interaction energy for two spheres at constants surface</span>
<span class="sd">    potential, according to Carnie&amp;Chan-1993.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    phi01  : float, constant potential on the surface of the sphere 1.</span>
<span class="sd">    phi02  : float, constant potential on the surface of the sphere 2.</span>
<span class="sd">    r1     : float, radius of sphere 1.</span>
<span class="sd">    r2     : float, radius of sphere 2.</span>
<span class="sd">    R      : float, distance center to center.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    epsilon: float, water dielectric constant.</span>

<span class="sd">    Note:</span>
<span class="sd">         Even though it admits phi01 and phi02, they should be identical; and</span>
<span class="sd">         the same is applicable to r1 and r2.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    E_inter: float, interaction energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#   From Carnie+Chan 1993</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of terms in expansion</span>

    <span class="n">qe</span> <span class="o">=</span> <span class="mf">1.60217646e-19</span>
    <span class="n">Na</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>
    <span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187818e-12</span>
    <span class="n">cal2J</span> <span class="o">=</span> <span class="mf">4.184</span>

    <span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>

    <span class="n">k1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span>

    <span class="n">i1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r2</span><span class="p">))</span>

    <span class="n">B</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">nu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">nu</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="n">nu</span><span class="p">:</span>
                    <span class="n">g1</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g2</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g3</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g4</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">1.5</span><span class="p">)</span>
                    <span class="n">f1</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f2</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f3</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f4</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
                    <span class="n">Anm</span> <span class="o">=</span> <span class="n">g1</span> <span class="o">*</span> <span class="n">g2</span> <span class="o">*</span> <span class="n">g3</span> <span class="o">*</span> <span class="n">f1</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="n">pi</span> <span class="o">*</span> <span class="n">g4</span> <span class="o">*</span> <span class="n">f2</span> <span class="o">*</span> <span class="n">f3</span> <span class="o">*</span> <span class="n">f4</span><span class="p">)</span>
                    <span class="n">kB</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span>
                                    <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">R</span><span class="p">))</span>
                    <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Anm</span> <span class="o">*</span> <span class="n">kB</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">i1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">k1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">RHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">RHS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi01</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">RHS</span><span class="p">)</span>

    <span class="n">a0</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">U</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a0</span> <span class="o">/</span> <span class="n">phi01</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">)</span> <span class="o">+</span> <span class="n">kappa</span> <span class="o">*</span>
                  <span class="n">r1</span> <span class="o">+</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>

    <span class="n">C0</span> <span class="o">=</span> <span class="n">qe</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Na</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">/</span> <span class="p">(</span><span class="n">cal2J</span> <span class="o">*</span> <span class="n">E_0</span><span class="p">)</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">phi01</span> <span class="o">*</span> <span class="n">phi01</span>
    <span class="n">E_inter</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">C1</span> <span class="o">*</span> <span class="n">C0</span>
</div>
    <span class="k">return</span> <span class="n">E_inter</span>


<div class="viewcode-block" id="constant_charge_twosphere_identical"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.constant_charge_twosphere_identical">[docs]</a><span class="k">def</span> <span class="nf">constant_charge_twosphere_identical</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    It computes the interaction energy for two spheres at constants surface</span>
<span class="sd">    charge, according to Carnie&amp;Chan-1993.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    sigma  : float, constant charge on the surface of the spheres.</span>
<span class="sd">    a      : float, radius of spheres.</span>
<span class="sd">    R      : float, distance center to center.</span>
<span class="sd">    kappa  : float, reciprocal of Debye length.</span>
<span class="sd">    epsilon: float, water dielectric constant.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    E_inter: float, interaction energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#   From Carnie+Chan 1993</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Number of terms in expansion</span>
    <span class="n">E_p</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Permitivitty inside sphere</span>

    <span class="n">qe</span> <span class="o">=</span> <span class="mf">1.60217646e-19</span>
    <span class="n">Na</span> <span class="o">=</span> <span class="mf">6.0221415e23</span>
    <span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187818e-12</span>
    <span class="n">cal2J</span> <span class="o">=</span> <span class="mf">4.184</span>

    <span class="n">index2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">K1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">K1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">K1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">K1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">k1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">))</span>
    <span class="n">k1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">))</span> <span class="o">*</span> <span class="n">K1p</span>

    <span class="n">I1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">I1p</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">I1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">))</span>
    <span class="n">i1p</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">iv</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">))</span> <span class="o">*</span> <span class="n">I1p</span>

    <span class="n">B</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">nu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">nu</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="n">nu</span><span class="p">:</span>
                    <span class="n">g1</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g2</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g3</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">g4</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">1.5</span><span class="p">)</span>
                    <span class="n">f1</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f2</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f3</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span>
                    <span class="n">f4</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
                    <span class="n">Anm</span> <span class="o">=</span> <span class="n">g1</span> <span class="o">*</span> <span class="n">g2</span> <span class="o">*</span> <span class="n">g3</span> <span class="o">*</span> <span class="n">f1</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="n">pi</span> <span class="o">*</span> <span class="n">g4</span> <span class="o">*</span> <span class="n">f2</span> <span class="o">*</span> <span class="n">f3</span> <span class="o">*</span> <span class="n">f4</span><span class="p">)</span>
                    <span class="n">kB</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span>
                                    <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">R</span><span class="p">))</span>
                    <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Anm</span> <span class="o">*</span> <span class="n">kB</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">E_p</span> <span class="o">/</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">i1p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">E_p</span> <span class="o">/</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="n">k1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">k1p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">RHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">RHS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">/</span> <span class="n">epsilon</span>

    <span class="n">a_coeff</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">RHS</span><span class="p">)</span>

    <span class="n">a0</span> <span class="o">=</span> <span class="n">a_coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">C0</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">/</span> <span class="n">epsilon</span>
    <span class="n">CC0</span> <span class="o">=</span> <span class="n">qe</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Na</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mf">1e10</span> <span class="o">/</span> <span class="p">(</span><span class="n">cal2J</span> <span class="o">*</span> <span class="n">E_0</span><span class="p">)</span>

    <span class="n">E_inter</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">CC0</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">a0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">C0</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span>
            <span class="mi">1</span> <span class="o">+</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</div>
    <span class="k">return</span> <span class="n">E_inter</span>

<div class="viewcode-block" id="Cext_analytical"><a class="viewcode-back" href="../../../source/pygbe.util.html#pygbe.util.an_solution.Cext_analytical">[docs]</a><span class="k">def</span> <span class="nf">Cext_analytical</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">diel_out</span><span class="p">,</span> <span class="n">diel_in</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the analytical solution of the extinction cross section.</span>
<span class="sd">    This solution is valid when the nano particle involved is a sphere. </span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    radius    : float, radius of the sphere in [nm].</span>
<span class="sd">    wavelength: float/array of floats, wavelength of the incident</span>
<span class="sd">                electric field in [nm].</span>
<span class="sd">    diel_out  : complex/array of complex, dielectric constant inside surface.</span>
<span class="sd">    diel_in   : complex/array of complex, dielectric constant inside surface. </span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    Cext_an   : float/array of floats, extinction cross section.     </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wavenumber</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">diel_out</span><span class="p">)</span> <span class="o">/</span> <span class="n">wavelength</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="n">wavenumber</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">diel_in</span> <span class="o">/</span> <span class="n">diel_out</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">diel_in</span> <span class="o">/</span> <span class="n">diel_out</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">Cext_an</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radius</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="n">wavenumber</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="n">C1</span><span class="o">.</span><span class="n">imag</span> 
    </div>
    <span class="k">return</span> <span class="n">Cext_an</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">PyGBe</a></h1>



<p class="blurb">Python, GPUs and Boundary elements for biomolecular electrostatics</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=barbagroup&repo=pygbe&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<a href="http://dx.doi.org/10.21105/joss.00043"><img src="http://joss.theoj.org/papers/10.21105/joss.00043/status.svg"></a>
<a href="http://www.doi2bib.org/#/doi/10.21105/joss.00043"><img src="https://img.shields.io/badge/Cite%20PyGBe-bibtex-blue.svg"></a><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../run.html">Run PyGBe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cite.html">Citing PyGBe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Developers Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mesh_pqr_setup.html">Generate meshes and pqr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input_format.html">Input File Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input_format.html#parameters-file-format">Parameters file format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../othersoftware.html">Other software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../programmatic.html">Programmatic use of PyGBe</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Christopher Cooper, Natalia Clementi, Gil Forsyth, Lorena Barba.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>